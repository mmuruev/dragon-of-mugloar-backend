/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.3-rc-4/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building a CLI application.
    id 'application'
}

java {
    sourceCompatibility = JavaVersion.VERSION_13 // just because my IDEA doesn't support 14 version yet
    targetCompatibility = JavaVersion.VERSION_14
}

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

ext {
    lombokVersion = '1.18.12'
    springBootVersion = '2.2.5.RELEASE'
    reactorSpringVersion = '1.0.1.RELEASE'
    aspectJversion = '1.6.10'

    junitVersion = '5.6.0'
}

dependencies {
    // This dependency is used by the application.
    implementation 'com.google.guava:guava:28.2-jre'

    implementation "org.springframework.boot:spring-boot-starter-webflux:${springBootVersion}"

    testImplementation ("org.springframework.boot:spring-boot-starter-test:${springBootVersion}") {
        exclude group: 'junit', module: 'junit'
    }

    implementation("org.projectreactor:reactor-spring:${reactorSpringVersion}") {
        exclude module: "spring-tx"
    }

    // WebClientTest
    testImplementation group: 'com.squareup.okhttp3', name: 'okhttp', version: '3.2.0'
    testImplementation group: 'com.squareup.okhttp3', name: 'mockwebserver', version: '4.4.1'

    implementation group: 'org.aspectj', name: 'aspectjweaver', version: "${aspectJversion}"

    // Fix issue 3464 Split SslContextFactory into Client and Server
    implementation group: 'org.eclipse.jetty', name: 'jetty-util', version: '9.4.27.v20200227'

    // LOMBOK
    compileOnly "org.projectlombok:lombok:${lombokVersion}"
    annotationProcessor "org.projectlombok:lombok:${lombokVersion}"

    testCompileOnly "org.projectlombok:lombok:${lombokVersion}"
    testAnnotationProcessor "org.projectlombok:lombok:${lombokVersion}"
    // LOMBOK END

    // Use JUnit Jupiter API for testing.
    testImplementation "org.junit.jupiter:junit-jupiter-api:${junitVersion}"

    // Use JUnit Jupiter Engine for testing.
    testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:${junitVersion}"
}

application {
    // Define the main class for the application.
    mainClassName = 'com.dragonofmugloar.backend.App'
}

test {
    // Use junit platform for unit tests
    useJUnitPlatform {
        excludeTags 'integration'
    }

    testLogging {
        events 'PASSED', 'FAILED', 'SKIPPED'
    }

    maxHeapSize = '512M'
}

task integrationTest(type: Test) {
    useJUnitPlatform {
        includeTags 'integration'
    }
    check.dependsOn it
    shouldRunAfter test

    testLogging {
        events 'PASSED', 'FAILED', 'SKIPPED'
    }

    maxHeapSize = '512M'
}
